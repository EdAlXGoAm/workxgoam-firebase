<!-- Modal Backdrop -->
<div *ngIf="showModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
  <!-- Modal Content -->
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">Gestionar Entornos y Proyectos</h3>
      <button (click)="close()" class="text-gray-400 hover:text-gray-600 transition">
        <i class="fas fa-times fa-lg"></i>
      </button>
    </div>

    <!-- Tab Navigation -->
    <div class="px-6 py-3 border-b border-gray-200">
      <nav class="flex space-x-4">
        <button 
          (click)="selectTab('environments')" 
          [class.border-indigo-600]="activeTab === 'environments'"
          [class.text-indigo-600]="activeTab === 'environments'"
          [class.border-transparent]="activeTab !== 'environments'"
          [class.text-gray-500]="activeTab !== 'environments'"
          class="pb-2 px-1 border-b-2 font-medium text-sm hover:text-indigo-500 focus:outline-none">
          Entornos
        </button>
        <button 
          (click)="selectTab('projects')" 
          [class.border-indigo-600]="activeTab === 'projects'"
          [class.text-indigo-600]="activeTab === 'projects'"
          [class.border-transparent]="activeTab !== 'projects'"
          [class.text-gray-500]="activeTab !== 'projects'"
          class="pb-2 px-1 border-b-2 font-medium text-sm hover:text-indigo-500 focus:outline-none">
          Proyectos
        </button>
      </nav>
    </div>

    <!-- Modal Body -->
    <div class="p-6" style="max-height: 60vh; overflow-y: auto;">
      <!-- Environments Tab Content -->
      <div *ngIf="activeTab === 'environments'">
        <div class="flex justify-between items-center mb-4">
          <h4 class="text-lg font-semibold text-gray-700">Entornos</h4>
          <button (click)="openAddEnvironmentModal()" 
                      class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <i class="fas fa-plus mr-2"></i>Agregar Entorno
              </button>
        </div>

        <!-- List of environments -->
        <div *ngIf="environments.length === 0" class="text-center text-gray-500 py-8">
          <i class="fas fa-layer-group text-4xl mb-4 text-gray-300"></i>
          <p class="text-lg">No hay entornos creados</p>
          <p class="text-sm">Comienza creando tu primer entorno</p>
        </div>
        <ul *ngIf="environments.length > 0" class="space-y-3">
          <li *ngFor="let env of environments" class="bg-white p-4 rounded-lg shadow border border-gray-200 flex justify-between items-center hover:shadow-md transition-shadow">
            <div class="flex items-center">
              <div class="w-4 h-4 rounded-full mr-3" [style.background-color]="env.color"></div>
              <span *ngIf="env.emoji" class="text-xl mr-2">{{ env.emoji }}</span>
            <div>
              <p class="font-semibold text-gray-800">{{ env.name }}</p>
                <p class="text-xs text-gray-500">{{ getProjectCountByEnvironment(env.id) }} proyecto(s)</p>
              </div>
            </div>
            <div class="space-x-2 flex-shrink-0">
              <button (click)="editEnvironment(env)" class="p-2 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded transition">
                <i class="fas fa-pencil-alt"></i>
              </button>
              <button (click)="deleteEnvironment(env.id)" class="p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </li>
        </ul>
      </div>

      <!-- Projects Tab Content -->
      <div *ngIf="activeTab === 'projects'">
        <div class="flex justify-between items-center mb-4">
          <h4 class="text-lg font-semibold text-gray-700">Proyectos</h4>
          <button (click)="openAddProjectModal()" 
                      class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <i class="fas fa-plus mr-2"></i>Agregar Proyecto
              </button>
        </div>

        <!-- List of projects -->
        <div *ngIf="projects.length === 0" class="text-center text-gray-500 py-8">
          <i class="fas fa-folder text-4xl mb-4 text-gray-300"></i>
          <p class="text-lg">No hay proyectos creados</p>
          <p class="text-sm">Comienza creando tu primer proyecto</p>
        </div>
        <ul *ngIf="projects.length > 0" class="space-y-3">
          <li *ngFor="let proj of projects" class="bg-white p-4 rounded-lg shadow border border-gray-200 flex justify-between items-center hover:shadow-md transition-shadow">
            <div>
              <p class="font-semibold text-gray-800">{{ proj.name }}</p>
              <p class="text-sm text-gray-600">{{ proj.description || 'Sin descripción' }}</p>
              <div class="flex items-center mt-1">
                <div class="w-3 h-3 rounded-full mr-2" [style.background-color]="getEnvironmentColor(proj.environment)"></div>
                <p class="text-xs text-indigo-600">{{ getEnvironmentName(proj.environment) || 'Entorno no disponible' }}</p>
              </div>
            </div>
            <div class="space-x-2 flex-shrink-0">
              <button (click)="editProject(proj)" class="p-2 text-indigo-600 hover:text-indigo-800 hover:bg-indigo-50 rounded transition">
                <i class="fas fa-pencil-alt"></i>
              </button>
              <button (click)="deleteProject(proj.id)" class="p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded transition">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Entorno (componente reutilizable) -->
<app-environment-modal
  *ngIf="showEnvironmentModal"
  [showModal]="showEnvironmentModal"
  [suggestedColors]="suggestedColors"
  [isEditing]="environmentToEdit !== null"
  [initialEnvironment]="environmentToEdit"
  (closeModal)="closeEnvironmentModal()"
  (saveEnvironment)="onSaveEnvironment($event)">
</app-environment-modal>

<!-- Modal para Agregar Proyecto -->
<div *ngIf="showAddProjectModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[60] p-4">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transition-all">
    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">Agregar Nuevo Proyecto</h3>
      <button (click)="closeProjectModal()" class="text-gray-400 hover:text-gray-600 transition">
        <i class="fas fa-times fa-lg"></i>
      </button>
    </div>
    <div class="p-6">
      <form (ngSubmit)="saveProject()" class="space-y-4">
        <div>
          <label for="projectName" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Proyecto</label>
          <input type="text" id="projectName" name="projectName" [(ngModel)]="currentProject.name" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                 placeholder="Ingresa el nombre del proyecto">
        </div>
        <div>
          <label for="projectDescription" class="block text-sm font-medium text-gray-700 mb-1">Descripción (Opcional)</label>
          <textarea id="projectDescription" name="projectDescription" [(ngModel)]="currentProject.description" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                    placeholder="Describe brevemente el proyecto"></textarea>
        </div>
        <div>
          <label for="projectEnvironment" class="block text-sm font-medium text-gray-700 mb-1">Entorno</label>
          
          <!-- Selector nativo para desktop (≥768px) -->
          <select id="projectEnvironment" name="projectEnvironment" [(ngModel)]="currentProject.environment" required
                  class="hidden md:block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white">
            <option [ngValue]="null" disabled>Selecciona un entorno</option>
            <option *ngFor="let env of environments" [value]="env.id">{{ env.emoji ? env.emoji + ' ' + env.name : env.name }}</option>
          </select>
          
          <!-- Selector personalizado para móvil (<768px) -->
          <div class="block md:hidden">
            <app-custom-select
              [options]="environmentOptions"
              [(ngModel)]="currentProject.environment"
              (optionSelected)="onEnvironmentSelectCustom($event)"
              name="projectEnvironmentCustom"
              placeholder="Selecciona un entorno"
              maxHeightClass="max-h-32">
            </app-custom-select>
          </div>
        </div>
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" (click)="closeProjectModal()"
                  class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none">
            Cancelar
          </button>
          <button type="submit"
                  class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Crear Proyecto
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal para Editar Proyecto -->
<div *ngIf="showEditProjectModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[60] p-4">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-md transition-all">
    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-800">Editar Proyecto</h3>
      <button (click)="closeProjectModal()" class="text-gray-400 hover:text-gray-600 transition">
        <i class="fas fa-times fa-lg"></i>
      </button>
    </div>
    <div class="p-6">
      <form (ngSubmit)="saveProject()" class="space-y-4">
        <div>
          <label for="editProjectName" class="block text-sm font-medium text-gray-700 mb-1">Nombre del Proyecto</label>
          <input type="text" id="editProjectName" name="editProjectName" [(ngModel)]="currentProject.name" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        </div>
        <div>
          <label for="editProjectDescription" class="block text-sm font-medium text-gray-700 mb-1">Descripción (Opcional)</label>
          <textarea id="editProjectDescription" name="editProjectDescription" [(ngModel)]="currentProject.description" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
        </div>
        <div>
          <label for="editProjectEnvironment" class="block text-sm font-medium text-gray-700 mb-1">Entorno</label>
          
          <!-- Selector nativo para desktop (≥768px) -->
          <select id="editProjectEnvironment" name="editProjectEnvironment" [(ngModel)]="currentProject.environment" required
                  class="hidden md:block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm bg-white">
            <option [ngValue]="null" disabled>Selecciona un entorno</option>
            <option *ngFor="let env of environments" [value]="env.id">{{ env.emoji ? env.emoji + ' ' + env.name : env.name }}</option>
          </select>
          
          <!-- Selector personalizado para móvil (<768px) -->
          <div class="block md:hidden">
            <app-custom-select
              [options]="environmentOptions"
              [(ngModel)]="currentProject.environment"
              (optionSelected)="onEnvironmentSelectCustom($event)"
              name="editProjectEnvironmentCustom"
              placeholder="Selecciona un entorno"
              maxHeightClass="max-h-32">
            </app-custom-select>
          </div>
        </div>
        <div class="flex justify-end space-x-3 pt-4">
          <button type="button" (click)="closeProjectModal()"
                  class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none">
            Cancelar
          </button>
          <button type="submit"
                  class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Guardar Cambios
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
